\u003c!DOCTYPE html\u003e
\u003c!--Push from VM1--\u003e
\u003chtml lang="en"\u003e

\u003chead\u003e
\u003cmeta charset="UTF-8"\u003e
\u003cmeta name="viewport" content="width=device-width, initial-scale=1.0"\u003e
\u003ctitle\u003eVibeBuy - MFA Setup\u003c/title\u003e
\u003cstyle\u003e
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

* {
margin: 0;
padding: 0;
box-sizing: border-box;
}

body {
font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
-webkit-font-smoothing: antialiased;
-moz-osx-font-smoothing: grayscale;
background: #faf8f9;
display: flex;
align-items: center;
justify-content: center;
min-height: 100vh;
}

.mfa-container {
background: white;
padding: 40px;
border-radius: 16px;
box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
width: 100%;
max-width: 400px;
text-align: center;
}

h1 {
font-size: 24px;
font-weight: 700;
color: #1a1a1a;
margin-bottom: 16px;
}

p {
color: #666;
font-size: 14px;
margin-bottom: 24px;
line-height: 1.5;
}

.qr-code-container {
margin-bottom: 24px;
padding: 16px;
border: 2px dashed #e5e5e5;
border-radius: 8px;
display: inline-block;
}

.qr-code-container img {
max-width: 200px;
display: block;
}

.input-wrapper {
margin-bottom: 24px;
}

input {
width: 100%;
padding: 14px;
border: 2px solid #e5e5e5;
border-radius: 8px;
font-size: 18px;
text-align: center;
letter-spacing: 4px;
transition: all 0.3s ease;
font-family: monospace;
}

input:focus {
outline: none;
border-color: #a855f7;
box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.1);
}

.btn-primary {
width: 100%;
padding: 16px;
background: linear-gradient(135deg, #a855f7, #ec4899);
color: white;
border: none;
border-radius: 8px;
font-size: 16px;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
}

.btn-primary:hover {
transform: translateY(-2px);
box-shadow: 0 8px 16px rgba(168, 85, 247, 0.3);
}

.error-message {
color: #c33;
font-size: 14px;
margin-top: 16px;
display: none;
}

.error-message.show {
display: block;
}
\u003c/style\u003e
\u003c/head\u003e

\u003cbody\u003e
\u003cdiv class="mfa-container"\u003e
\u003ch1\u003eTwo-Factor Auth\u003c/h1\u003e
\u003cp\u003eScan this QR code with your Google Authenticator app, then enter the 6-digit code below.\u003c/p\u003e

\u003cdiv class="qr-code-container" id="qrContainer"\u003e
\u003cp\u003eLoading QR Code...\u003c/p\u003e
\u003c/div\u003e

\u003cdiv class="input-wrapper"\u003e
\u003cinput type="text" id="token" placeholder="000000" maxlength="6" pattern="\d*"\u003e
\u003c/div\u003e

\u003cbutton class="btn-primary" id="verifyBtn"\u003eVerify Code\u003c/button\u003e
\u003cdiv class="error-message" id="errorMessage"\u003e\u003c/div\u003e
\u003c/div\u003e

\u003cscript\u003e
// Backend URL configuration
const BACKEND_URL = 'http://100.105.55.118:5000';

// Get DOM elements
const qrContainer = document.getElementById('qrContainer');
const errorMessage = document.getElementById('errorMessage');
const tokenInput = document.getElementById('token');
const verifyBtn = document.getElementById('verifyBtn');

// Get userId from URL parameters or localStorage
const urlParams = new URLSearchParams(window.location.search);
const userId = urlParams.get('userId') || localStorage.getItem('userId');

async function setupMFA() {
try {
const response = await fetch(`${BACKEND_URL}/api/mfa/setup`, {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify({ userId })
});
const data = await response.json();

if (response.ok) {
qrContainer.innerHTML = `\u003cimg src="${data.qrCode}" alt="MFA QR Code"\u003e`;
} else {
errorMessage.textContent = 'Failed to load QR code';
errorMessage.classList.add('show');
}
} catch (err) {
console.error(err);
errorMessage.textContent = 'Server error';
errorMessage.classList.add('show');
}
}

// Verify Token
async function verifyMFA() {
const token = tokenInput.value;
if (token.length !== 6) return;

verifyBtn.disabled = true;
verifyBtn.textContent = 'Verifying...';

try {
const response = await fetch(`${BACKEND_URL}/api/mfa/verify`, {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify({ userId, token })
});
const data = await response.json();

if (response.ok) {
window.location.href = 'index.html';
} else {
errorMessage.textContent = data.message || 'Invalid code';
errorMessage.classList.add('show');
verifyBtn.disabled = false;
verifyBtn.textContent = 'Verify Code';
}
} catch (err) {
console.error(err);
errorMessage.textContent = 'Server error';
errorMessage.classList.add('show');
verifyBtn.disabled = false;
verifyBtn.textContent = 'Verify Code';
}
}

verifyBtn.addEventListener('click', verifyMFA);
setupMFA();
\u003c/script\u003e
\u003c/body\u003e

\u003c/html\u003e